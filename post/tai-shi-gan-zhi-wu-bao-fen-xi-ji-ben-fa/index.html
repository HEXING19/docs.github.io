<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>态势感知误报分析基本法 | Blog</title>
<meta name="description" content="Keep Learning">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="https://github.com/HEXING19/docs.github.io/favicon.ico?v=1646050634885">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/papercss@1.6.1/dist/paper.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://github.com/HEXING19/docs.github.io/styles/main.css">


<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />


  </head>
  <body>
  
    <nav class="navbar border fixed split-nav">
  <div class="nav-brand">
    <h3><a href="https://github.com/HEXING19/docs.github.io">Blog</a></h3>
  </div>
  <div class="collapsible">
    <input id="collapsible1" type="checkbox" name="collapsible1">
    <button>
      <label for="collapsible1">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </label>
    </button>
    <div class="collapsible-body">
      <ul class="inline">
        
          <li>
            
              <a href="/" class="menu">
                首页
              </a>
            
          </li>
        
          <li>
            
              <a href="/archives" class="menu">
                归档
              </a>
            
          </li>
        
          <li>
            
              <a href="/tags" class="menu">
                标签
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/about" class="menu">
                关于
              </a>
            
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div id="top" class="row site">
      <div class="sm-12 md-8 col">
        <div class="paper">
          <article class="article">
            <h1>态势感知误报分析基本法</h1>
            <p class="article-meta">
              2022-02-28
              
                <a href="https://github.com/HEXING19/docs.github.io/tag/OACgqZQQ8/" class="badge warning">
                  安全效果
                </a>
              
                <a href="https://github.com/HEXING19/docs.github.io/tag/t5LZ5XbLp/" class="badge secondary">
                  态势感知
                </a>
              
            </p>
            
              <img src="https://github.com/HEXING19/docs.github.io/post-images/tai-shi-gan-zhi-wu-bao-fen-xi-ji-ben-fa.jpg" alt="态势感知误报分析基本法">
            
            <div class="post-content">
              <p><strong>SIP误报研判方法</strong><br>
<strong>方法总结</strong><br>
 根据SIP给出的威胁描述，寻找关键检出点，如SQL注入，查看请求中是否存在注入语句。部分不熟悉的攻击，可以在网上搜索此类攻击Payload作为参考（有些误报可以直接搜索出来是业务语句），结合请求中的上下文分析，客户正常业务通常有明显特征。<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646046211679.png" alt="" loading="lazy"><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646046240072.png" alt="" loading="lazy"><br>
<strong>挖矿、病毒家族</strong><br>
 遇见挖矿、病毒家族，可以将IP/域名在微步,VT等威胁情报中查询确认（详见在线网站检测章节），会有部分网站未标记恶意，但是通信样本中存在恶意文件。</p>
<p><strong>系统漏洞部分</strong><br>
 如遇见漏洞，在没有具体举证，HEX特征不了解的情况下，采取关联分析，该IP是否还存在其他恶意行为。最后仍无法判断联系研发同事分析数据包。</p>
<p><strong>web攻击利用</strong><br>
 web端攻击利用，大多数的web端攻击类型都能在网上搜索到相关利用代码，根据态势感知高亮标红部分搜索网上公开payload作为参考，综合上下文分析是不是为客户正常业务。</p>
<p><strong>恶意文件/软件类</strong><br>
 恶意文件类，通常搜索MD5值，下载源文件进行查杀验证。</p>
<p><strong>黑客工具类</strong><br>
 黑客工具类，常见为frp，cs，远控软件，根据检测特征字段结合上下文。如cs工具，可根据以下纬度进行判断<br>
（1）基于工具服务器默认特征的角度，符合cs服务器特征（默认证书，默认端口50000）<br>
（2）针对3.13以前版本在搜索 &quot;HTTP/1.1 404 Not Found Date:&quot; +&quot;GMT Content-Type: text/plain Content-Length: 0&quot; -&quot;Connection:” ，基于其服务器的相应包的特点可以判断该服务器为cs，善用浏览器跟搜索引擎<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646046407726.png" alt="" loading="lazy"><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646046416122.png" alt="" loading="lazy"></p>
<p><strong>其他类</strong><br>
 根据命中的规则反向佐证是否为误报，规则中有原理跟处置建议。<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646046448411.png" alt="" loading="lazy"></p>
<p><strong>告警分析</strong><br>
<em><strong>webshell访问</strong></em><br>
<strong>ASHX文件上传绕过</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646047622230.png" alt="" loading="lazy"><br>
请求地址中存在类似绕过语句 a.ashx/b.png，响应体内容为微信跳转，且无上传数据。判断为误报。</p>
<p><strong>IIS解析漏洞文件上传绕过</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646047682263.png" alt="" loading="lazy"><br>
部分特征符合IIS解析漏洞文件上传，可以看到请求体中应该是多个图片文件同时上传，“；”作为分隔符。IIS解析漏洞特征“1.jpg;.asp”，因此出现误报。</p>
<p><strong>系统命令注入</strong><br>
研判思路：系统命令注入常见于客户自身业务误报，乱码误报，同时会命中一些关键字。<br>
查看请求头是否有异常字符插入，请求体内容是否符合正常业务。存在一部分告警中有明确的关键字 如 whoami ping之类，需要判断此请求是否是日志文件。</p>
<p><strong>通用系统命令注入攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646047739837.png" alt="" loading="lazy"><br>
请求体与响应体中都是乱码，且请求URI中存在Servlet字样，初步判断是自身业务。可结合日志检索，查看是否有其他关联攻击。<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646047773550.png" alt="" loading="lazy"><br>
请求头中存在System关键字，URI中显示有cardinfo，可以判断出一个业务信息查询，仅是关键字被检测到。<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646047791037.png" alt="" loading="lazy"><br>
标红部分 存在&lt;&gt; .*?以及<code>，</code>可以执行命令,因此匹配上了<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646047818801.png" alt="" loading="lazy"><br>
存在关键字SET 以及环境变量信息导致误判</p>
<p><strong>ping命令注入攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646047876536.png" alt="" loading="lazy"><br>
搜索未发现ping命令,且请求体内容为业务相关</p>
<p><strong>whoami命令注入攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646047909269.png" alt="" loading="lazy"><br>
搜索未发现whoami命令,且请求体内容为业务相关</p>
<p>####### PHP代码注入<br>
<strong>通用PHP代码注入攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646048160988.png" alt="" loading="lazy"><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646048178943.png" alt="" loading="lazy"><br>
请求内容明显为自身业务</p>
<p><strong>发现Php Webshell popen函数</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646048245312.png" alt="" loading="lazy"><br>
关键字需要分析上下文，图中出现一些javascript，以及引入一些URL，没有看到恶意请求。</p>
<p><strong>2.4 Webshell上传</strong><br>
<strong>2.4.1 通用Webshell上传攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646048638494.png" alt="" loading="lazy"><br>
请求体内容是百度贴吧图片,因此判断误报</p>
<p><strong>2.4.2 Python Webshell上传</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646048713826.png" alt="" loading="lazy"><br>
XML请求格式,内容也没有webshell相关特征。</p>
<p><strong>2.5 XSS攻击</strong><br>
<strong>2.5.1 XSS 攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646048794852.jpg" alt="" loading="lazy"><br>
请求体中存在比较多的特征,需要查看是否存在不正常的语句插入,如alert(xxx)，或者其他不常见的事件（onerror,onclick...）</p>
<p>**2.6 SQL注入 **<br>
SQL注入常见误报为关键字误报，客户业务不规范在传输过程中有明文SQL语句。判断SQL注入需要了解常见的注入语句，以及关键函数。出现关键字后,分析上下文,是否还存在其他非正常语句,如果存在其他语句,需要针对该攻击者IP进行分析。</p>
<p><strong>2.6.1 database函数SQL注入攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646048858746.jpg" alt="" loading="lazy"></p>
<p><strong>2.6.2 Select语句SQL注入攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646048896507.jpg" alt="" loading="lazy"></p>
<p><strong>2.6.3 AppScan探测SQL注入攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646048927891.jpg" alt="" loading="lazy"></p>
<p><strong>2.6.4 NULLIF函数SQL注入攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646048954176.jpg" alt="" loading="lazy"></p>
<p><strong>2.6.5 MySQL Kill语句SQL注入攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646048992331.jpg" alt="" loading="lazy"></p>
<p><strong>2.6.6 MySQL Sleep函数SQL注入攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646049028091.jpg" alt="" loading="lazy"></p>
<p><strong>2.7 TLS加密异常</strong><br>
**2.7.1 HTTPS恶意通信 **<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646049702852.jpg" alt="" loading="lazy"><br>
威胁情报查看网站是否恶意，若无法判断就需要看证书内容，以及攻击者IP相关行为</p>
<p><strong>2.8 其他代码注入</strong><br>
**2.8.1 空字节注入攻击 **<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646049759933.gif" alt="" loading="lazy"><br>
在乱码情况下 经常出现空字节，需要看HEX，其中有00</p>
<p><strong>2.9 Java代码注入</strong><br>
<strong>2.9.1 Java代码注入攻击</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646049835334.gif" alt="" loading="lazy"><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646049842604.gif" alt="" loading="lazy"><br>
请求体中出现了JAVA关键字，需要结合上下文判断，一般代码注入都会存在EXEC、runtime。部分客户业务会存在相应代码，需要结合日志中心进行关联分析。</p>
<p><strong>2.10 下载恶意文件</strong><br>
<strong>2.10.1 下载恶意文件</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646049890142.gif" alt="" loading="lazy"><br>
外到内，访问http://xxx/cmds.exe 且状态码0，没有响应，可以判断是误报</p>
<p><strong>2.11 DRS命令执行</strong><br>
<strong>2.11.1 伪造域控发起DCSync请求</strong><br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646049940407.jpg" alt="" loading="lazy"><br>
DCSync请求是域控之间的行为，  客户的域控服务器被定义成终端，才会生成告警。终端跟域控进行通信为不正常情况，需要确认资产。</p>
<p><strong>3.如何利用在线检测网站协助分析安全事件</strong><br>
常说的vt网站https://www.virustotal.com/gui/<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646049994743.jpg" alt="" loading="lazy"><br>
分为3大部分，文件、url跟搜索（hash值、域名、 IP地址、URL或者自己创建一个IOC情报）可以根据已经威胁信息按需使用<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646050018353.png" alt="" loading="lazy"><br>
建议优先使用search栏进行搜索，会更加全面，当态势感知报毒，在线平台检测正常时，善用图表跟RELATIONS功能，有些报毒很可能因为恶意软件<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646050042946.png" alt="" loading="lazy"><br>
比如该例子，可以在RELATIONS中找到该域名应该是绑定了恶意软件<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646050066424.png" alt="" loading="lazy"><br>
通过图表功能也可以很快找到<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646050094676.jpg" alt="" loading="lazy"><br>
微步在线（https://x.threatbook.cn）检测同理，微步在线支持IP地址、域名、url、邮箱、CVE、CNVD都在一个搜索框内检测<br>
<img src="https://github.com/HEXING19/docs.github.io/post-images/1646050123750.jpg" alt="" loading="lazy"><br>
其他在线检测网站<br>
深信服（https://ti.sangfor.com.cn/analysis-platform）<br>
友商（https://ti.qianxin.com/）<br>
腾讯哈勃（https://habo.qq.com/）<br>
公共dns服务记录查询（https://passivedns.mnemonic.no/）<br>
在线数据包检测工具（https://packettotal.com/）</p>
<p><strong>4.误报漏报协助判断准备信息</strong><br>
需要提前收集事件详情，下载json字段，有数据包的情况下载数据包，事件IP上下文日志</p>

            </div>
          </article>
        </div>
        <div class="paper" data-aos="fade-in">
          
            <div class="next-post">
              <div class="next">
                下一篇
              </div>
              <a href="https://github.com/HEXING19/docs.github.io/post/hello-gridea/">
                <h3 class="post-title">
                  Hello Gridea
                </h3>
              </a>
            </div>
          
        </div>
        
      </div>

      <div class="sm-12 md-4 col sidebar">
  <div class="paper info-container">
    <img src="https://github.com/HEXING19/docs.github.io/images/avatar.png?v=1646050634885" class="no-responsive avatar">
    <div class="text-muted">Keep Learning</div>
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      最新文章
    </div>
    <div class="row">
      <ul>
        
          
            <li>
              <a href="https://github.com/HEXING19/docs.github.io/post/tai-shi-gan-zhi-wu-bao-fen-xi-ji-ben-fa/">态势感知误报分析基本法</a>
            </li>
          
        
          
            <li>
              <a href="https://github.com/HEXING19/docs.github.io/post/about/">关于</a>
            </li>
          
        
          
            <li>
              <a href="https://github.com/HEXING19/docs.github.io/post/hello-gridea/">Hello Gridea</a>
            </li>
          
        
      </ul>
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      标签列表
    </div>
    <div class="row">
      
        <a href="https://github.com/HEXING19/docs.github.io/tag/OACgqZQQ8/" class="badge ">
          安全效果
        </a>
      
        <a href="https://github.com/HEXING19/docs.github.io/tag/t5LZ5XbLp/" class="badge warning">
          态势感知
        </a>
      
        <a href="https://github.com/HEXING19/docs.github.io/tag/6zQu5IwKx/" class="badge warning">
          Gridea
        </a>
      
    </div>
  </div>
  <div class="paper">
    Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://github.com/HEXING19/docs.github.io/atom.xml" target="_blank">RSS</a>
  </div>
</div>


    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

</script>




  </body>
</html>
